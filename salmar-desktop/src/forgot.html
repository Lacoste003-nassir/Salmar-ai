<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light">
  <title>Salmar AI — Forgot Password</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config for fonts, colors, shadows
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji']
          },
          colors: {
            violetdeep: '#2E105D',
            violetdim: '#1a0a36',
            accent: {
              50: '#f5f3ff',
              100: '#ede9fe',
              200: '#ddd6fe',
              300: '#c4b5fd',
              400: '#a78bfa',
              500: '#8b5cf6',
              600: '#7c3aed',
              700: '#6d28d9',
              800: '#5b21b6',
              900: '#4c1d95'
            }
          },
          boxShadow: {
            'neo-sm': '8px 8px 16px rgba(0,0,0,0.35), -8px -8px 16px rgba(255,255,255,0.06)',
            'neo-inset': 'inset 4px 4px 12px rgba(0,0,0,0.35), inset -4px -4px 12px rgba(255,255,255,0.06)',
            'neon': '0 0 0 1px rgba(167,139,250,0.5), 0 0 24px rgba(167,139,250,0.35), inset 0 0 24px rgba(167,139,250,0.15)',
          },
          backdropBlur: {
            xs: '2px'
          },
          keyframes: {
            floaty: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-8px)' }
            },
            glowPulse: {
              '0%': { boxShadow: '0 0 0px rgba(167,139,250,0.0)' },
              '50%': { boxShadow: '0 0 24px rgba(167,139,250,0.45)' },
              '100%': { boxShadow: '0 0 0px rgba(167,139,250,0.0)' }
            },
            wave: {
              '0%': { transform: 'translateX(-10%) translateY(0) scale(1)' },
              '50%': { transform: 'translateX(10%) translateY(5%) scale(1.05)' },
              '100%': { transform: 'translateX(-10%) translateY(0) scale(1)' }
            }
          },
          animation: {
            floaty: 'floaty 5s ease-in-out infinite',
            glowPulse: 'glowPulse 3.5s ease-in-out',
            wave: 'wave 18s ease-in-out infinite'
          }
        }
      }
    }
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- zxcvbn for password strength -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"
    integrity="sha512-dQ34tOb2ZxGfg8cQAk3DpTisBhtj0fUPoUtgM9K+zC+8m9yhoTIc3qf4+Zf9Ts6r6QAbH8Y7Gkv5E4usE5Olpg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Anime.js for subtle finishing effects -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"
    integrity="sha512-98w8eU3r4xvG7BD4IUyJQd3r7V3rQ+0nQQQzNDPQ0jAbJly3CphwTrxH9XoWkqQzU+f1c3dMfx0JXWZr9b5Y2w=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    :root {
      --bg-start: #140727;
      --bg-mid: #2a0b53;
      --bg-end: #3a0e6e;
      --text-primary: #EDE9FE;
      --text-muted: #C4B5FD;
      --card-bg: rgba(255, 255, 255, 0.08);
      --card-border: rgba(167, 139, 250, 0.45);
      --glass: rgba(255, 255, 255, 0.06);
      --accent: #8b5cf6;
      --accent-strong: #a78bfa;
      --success: #14b8a6;
      --warning: #f59e0b;
      --danger: #ef4444;
    }

    [data-theme="light"] {
      --bg-start: #f5f3ff;
      --bg-mid: #ede9fe;
      --bg-end: #e9d5ff;
      --text-primary: #1f1147;
      --text-muted: #4c1d95;
      --card-bg: rgba(255, 255, 255, 0.72);
      --card-border: rgba(139, 92, 246, 0.45);
      --glass: rgba(255, 255, 255, 0.5);
      --accent: #7c3aed;
      --accent-strong: #6d28d9;
      --success: #0ea5e9;
      --warning: #d97706;
      --danger: #dc2626;
    }

    html,
    body {
      height: 100%;
    }

    body {
      background: radial-gradient(1200px 800px at 10% 10%, rgba(167, 139, 250, 0.12), transparent 60%),
        radial-gradient(900px 600px at 90% 80%, rgba(139, 92, 246, 0.10), transparent 60%),
        linear-gradient(135deg, var(--bg-start), var(--bg-mid) 40%, var(--bg-end));
      color: var(--text-primary);
      font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans;
      transition: background 600ms ease, color 400ms ease;
      overflow-x: hidden;
    }

    /* Soft glowing wave layers */
    .wave-layer {
      position: absolute;
      inset: -20% -10% -10% -20%;
      filter: blur(40px) saturate(120%);
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.45;
    }

    .wave-1 {
      background: radial-gradient(60% 60% at 20% 30%, rgba(167, 139, 250, 0.25), transparent 60%),
        radial-gradient(40% 40% at 80% 70%, rgba(139, 92, 246, 0.20), transparent 60%);
      animation: wave 22s ease-in-out infinite;
    }

    .wave-2 {
      background: radial-gradient(30% 30% at 70% 20%, rgba(236, 72, 153, 0.16), transparent 60%),
        radial-gradient(30% 30% at 15% 85%, rgba(59, 130, 246, 0.12), transparent 60%);
      animation: wave 26s ease-in-out infinite reverse;
      opacity: 0.35;
    }

    /* Glassmorphism card base */
    .glass {
      background: var(--card-bg);
      backdrop-filter: saturate(160%) blur(16px);
      -webkit-backdrop-filter: saturate(160%) blur(16px);
      border: 1px solid var(--card-border);
      box-shadow: 0 0 0 1px rgba(167, 139, 250, 0.15), 0 30px 80px rgba(0, 0, 0, 0.35), inset 0 0 24px rgba(167, 139, 250, 0.05);
    }

    .neon-outline {
      position: relative;
    }

    .neon-outline::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: inherit;
      background: conic-gradient(from 90deg, rgba(139, 92, 246, 0.0), rgba(139, 92, 246, 0.35), rgba(167, 139, 250, 0.45), rgba(139, 92, 246, 0.35), rgba(139, 92, 246, 0.0));
      filter: blur(16px);
      z-index: -1;
      opacity: 0.75;
    }

    .sr-only-focusable:focus {
      position: static !important;
      width: auto;
      height: auto;
      clip: auto;
      clip-path: none;
      overflow: visible;
      white-space: normal;
    }

    /* OTP inputs style */
    .otp-input {
      width: 3rem;
      height: 3.5rem;
      text-align: center;
      font-size: 1.25rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(167, 139, 250, 0.35);
      background: var(--glass);
      color: var(--text-primary);
      outline: none;
      transition: transform .15s ease, border-color .2s ease, box-shadow .2s ease, background .2s ease;
    }

    .otp-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.25);
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.62);
    }

    [data-theme="dark"] .otp-input:focus {
      background: rgba(255, 255, 255, 0.12);
    }

    /* Progress Bar */
    .progress-track {
      height: 8px;
      border-radius: 9999px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(167, 139, 250, 0.15), rgba(139, 92, 246, 0.95), rgba(167, 139, 250, 0.65));
      box-shadow: 0 0 24px rgba(167, 139, 250, 0.65);
      transition: width .6s cubic-bezier(.2, .9, .2, 1);
    }

    /* Strength meter */
    .strength-bar {
      height: 10px;
      border-radius: 9999px;
      background: linear-gradient(90deg, rgba(239, 68, 68, 0.3), rgba(234, 179, 8, 0.3), rgba(20, 184, 166, 0.3));
      overflow: hidden;
    }

    .strength-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ef4444, #f59e0b, #14b8a6);
      transition: width .45s ease, filter .35s ease, box-shadow .35s ease;
      filter: saturate(90%);
      box-shadow: 0 0 18px rgba(20, 184, 166, 0.35);
    }

    /* Lock animation */
    .lock {
      width: 80px;
      height: 100px;
      filter: drop-shadow(0 0 10px rgba(167, 139, 250, 0.35));
    }

    .lock .shackle {
      transform-origin: 40px 35px;
      transition: transform 0.6s ease;
    }

    .lock.unlocked .shackle {
      transform: rotate(-30deg) translateX(8px);
    }

    /* Floating particles canvas takes clicks through */
    #particles {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    /* Card glow when step completes */
    .card-glow {
      animation: glowPulse 1.5s ease-in-out;
    }

    /* Focus rings consistency */
    :focus-visible {
      outline: 3px solid rgba(139, 92, 246, 0.55);
      outline-offset: 2px;
      border-radius: 0.75rem;
    }

    /* Tiny noise layer for texture */
    .noise {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
      background-size: 3px 3px;
      opacity: .35;
      mix-blend-mode: overlay;
      z-index: 1;
    }

    /* Match signup split layout and logo panel */
    #main { width: 50vw; margin-right: 50vw; min-height: 100vh; display: block; }
    .logo-panel { position: fixed; inset: 0 0 0 auto; width: 50vw; z-index: 2; pointer-events: none; overflow: hidden; background: #0b0b0b; }
    .logo-panel::before { content: ""; position: absolute; inset: -10% -10% -10% -10%; background:
      radial-gradient(100% 60% at 50% 50%, rgba(255,255,255,0.06), rgba(0,0,0,0) 60%),
      linear-gradient(90deg, rgba(0,0,0,0.75), rgba(0,0,0,0.25) 40%, rgba(0,0,0,0)); filter: saturate(110%); }
    .logo-panel::after { content: ""; position: absolute; top: -10%; right: -25%; bottom: -10%; width: 55%; background:
      radial-gradient(closest-side, rgba(255,255,255,0.2), rgba(255,255,255,0.06) 60%, rgba(0,0,0,0) 100%);
      transform: rotate(-4deg); filter: blur(24px) saturate(110%); opacity: .85; }
    .logo-panel img { position: absolute; inset: 0; margin: auto; right: 8%; height: min(82vh, 880px); width: auto; opacity: .18; filter:
      contrast(1.15) saturate(1.05) drop-shadow(0 8px 40px rgba(0,0,0,.5)); mix-blend-mode: normal; }
    @media (max-width: 1024px) { #main { width: 100vw; margin-right: 0; } .logo-panel { display: none; } }

    /* Enforce same dark background as signup and disable older layers */
    html, body { background: #0b0b0b; }
    .wave-layer, #particles, .noise { display: none !important; }
  </style>
</head>

<body class="min-h-screen antialiased selection:bg-accent-600/40 selection:text-white">
  <!-- Right half-page logo panel (match signup) -->
  <aside class="logo-panel" aria-hidden="true">
    <img src="./logo.png" alt="Salmar" />
  </aside>
  <a href="#main"
    class="sr-only sr-only-focusable absolute left-2 top-2 z-[1000] px-3 py-2 rounded-md bg-accent-600 text-white">Skip
    to content</a>

  <!-- Animated background layers -->
  <canvas id="particles" aria-hidden="true"></canvas>
  <div class="wave-layer wave-1" aria-hidden="true"></div>
  <div class="wave-layer wave-2" aria-hidden="true"></div>
  <div class="noise" aria-hidden="true"></div>

  <!-- Header -->
  <header class="relative z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="inline-flex items-center justify-center h-10 w-10 rounded-xl overflow-hidden">
          <img src="./logo.png" alt="Salmar" width="28" height="28" style="display:block;filter:contrast(1.15) saturate(1.05);mix-blend-mode:multiply;" />
        </span>
        <div>
          <p class="text-lg font-semibold tracking-tight">Salmar AI</p>
          <p class="text-xs text-accent-200/80">Secure Account Recovery</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
      </div>
    </div>
  </header>

  <!-- Main -->
  <main id="main" class="relative z-10">
    <section class="px-4 sm:px-6 py-6">
      <div class="max-w-4xl mx-auto">

        <!-- Progress & Guidance -->
        <div class="mb-6 sm:mb-8">
          <div class="flex items-center justify-between mb-3">
            <p class="text-sm sm:text-base text-accent-200" aria-live="polite" aria-atomic="true" id="guidanceText">
              Step 1: Verify your identity.
            </p>
            <p id="deviceHint" class="text-xs text-accent-200/70"></p>
          </div>
          <div class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
            aria-label="Recovery progress">
            <div id="progressFill" class="progress-fill"></div>
          </div>
          <div class="mt-2 grid grid-cols-3 text-center text-[11px] sm:text-xs text-accent-200/80">
            <div>Verification</div>
            <div>Reset</div>
            <div>Secure</div>
          </div>
        </div>

        <!-- Recovery Card -->
        <div id="card" class="glass neon-outline rounded-3xl p-5 sm:p-8 shadow-neo-sm">
          <!-- Top warning/device/location -->
          <div id="securityBanner"
            class="rounded-2xl p-4 sm:p-5 mb-5 sm:mb-8 border border-accent-400/30 bg-gradient-to-br from-white/5 to-transparent relative overflow-hidden">
            <div class="absolute -top-10 -right-10 w-36 h-36 rounded-full bg-accent-500/10 blur-2xl"></div>
            <div class="flex items-start gap-3">
              <svg class="w-5 h-5 flex-none text-warning mt-0.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.4"></circle>
                <path d="M12 7v7M12 17.5v.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"></path>
              </svg>
              <div class="text-sm">
                <p class="font-semibold mb-1">Security check</p>
                <p id="securityMsg" class="text-accent-200/90">
                  Checking device and approximate location...
                </p>
                <div class="mt-2 flex flex-wrap gap-2 text-xs">
                  <span id="deviceChip" class="px-2 py-1 rounded-full bg-white/10 border border-accent-400/30">Device:
                    —</span>
                  <span id="osChip" class="px-2 py-1 rounded-full bg-white/10 border border-accent-400/30">OS: —</span>
                  <span id="tzChip" class="px-2 py-1 rounded-full bg-white/10 border border-accent-400/30">TZ: —</span>
                  <span id="locChip" class="px-2 py-1 rounded-full bg-white/10 border border-accent-400/30">Location:
                    —</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Method Selection -->
          <div id="step-verify" class="space-y-6">
            <h2 class="text-xl sm:text-2xl font-bold tracking-tight">Choose how to verify your identity</h2>
            <div class="grid sm:grid-cols-2 gap-4 sm:gap-5" role="listbox" aria-label="Verification methods">
              <!-- Email -->
              <button data-method="email"
                class="method-btn group rounded-2xl p-4 sm:p-5 bg-white/5 hover:bg-white/10 border border-accent-400/30 hover:border-accent-400/60 transition flex items-center gap-4 shadow-neo-sm focus-visible:shadow-neon"
                role="option" aria-selected="false">
                <div class="p-3 rounded-xl bg-accent-600/30 text-accent-100 shadow-neon group-hover:animate-floaty">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M4 6h16a2 2 0 012 2v.3l-10 6-10-6V8a2 2 0 012-2z" stroke="currentColor"
                      stroke-width="1.5" />
                    <path d="M22 10l-10 6L2 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                    <path d="M2 9.5V16a2 2 0 002 2h16a2 2 0 002-2V9.5" stroke="currentColor" stroke-width="1.5" />
                  </svg>
                </div>
                <div class="text-left">
                  <p class="font-semibold">Email verification</p>
                  <p class="text-xs text-accent-200/90">Receive a one-time code via email.</p>
                </div>
              </button>

              <!-- Biometric -->
              <button data-method="biometric"
                class="method-btn group rounded-2xl p-4 sm:p-5 bg-white/5 hover:bg-white/10 border border-accent-400/30 hover:border-accent-400/60 transition flex items-center gap-4 shadow-neo-sm focus-visible:shadow-neon"
                role="option" aria-selected="false">
                <div class="p-3 rounded-xl bg-accent-600/30 text-accent-100 shadow-neon group-hover:animate-floaty">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 2a7 7 0 00-7 7v2a7 7 0 1014 0V9a7 7 0 00-7-7z" stroke="currentColor"
                      stroke-width="1.6" />
                    <path d="M8 11a4 4 0 108 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                    <path d="M10 14c0 1.1.9 2 2 2s2-.9 2-2" stroke="currentColor" stroke-width="1.6"
                      stroke-linecap="round" />
                  </svg>
                </div>
                <div class="text-left">
                  <p class="font-semibold">Biometric recovery</p>
                  <p class="text-xs text-accent-200/90">Use FaceID/TouchID if supported.</p>
                </div>
              </button>

              <!-- Backup Phrase -->
              <button data-method="phrase"
                class="method-btn group rounded-2xl p-4 sm:p-5 bg-white/5 hover:bg-white/10 border border-accent-400/30 hover:border-accent-400/60 transition flex items-center gap-4 shadow-neo-sm focus-visible:shadow-neon"
                role="option" aria-selected="false">
                <div class="p-3 rounded-xl bg-accent-600/30 text-accent-100 shadow-neon group-hover:animate-floaty">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M4 7a2 2 0 012-2h12a2 2 0 012 2v12l-4-3-4 3-4-3-4 3V7z" stroke="currentColor"
                      stroke-width="1.6" stroke-linejoin="round" />
                    <path d="M8 9h8M8 12h5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  </svg>
                </div>
                <div class="text-left">
                  <p class="font-semibold">Backup phrase</p>
                  <p class="text-xs text-accent-200/90">Paste your recovery phrase to unlock reset.</p>
                </div>
              </button>

              <!-- Authenticator -->
              <button data-method="authapp"
                class="method-btn group rounded-2xl p-4 sm:p-5 bg-white/5 hover:bg-white/10 border border-accent-400/30 hover:border-accent-400/60 transition flex items-center gap-4 shadow-neo-sm focus-visible:shadow-neon"
                role="option" aria-selected="false">
                <div class="p-3 rounded-xl bg-accent-600/30 text-accent-100 shadow-neon group-hover:animate-floaty">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6" />
                    <path d="M12 7v5l4 2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  </svg>
                </div>
                <div class="text-left">
                  <p class="font-semibold">Authenticator app</p>
                  <p class="text-xs text-accent-200/90">Enter a 6-digit code from Google Authenticator/Authy.</p>
                </div>
              </button>
            </div>

            <!-- Dynamic Panels -->
            <div id="panels" class="space-y-8 mt-4 sm:mt-6">
              <!-- Email Panel -->
              <div id="panel-email" class="hidden">
                <form id="form-email" class="space-y-4" novalidate>
                  <label class="block">
                    <span class="text-sm font-medium">Email address</span>
                    <input type="email" inputmode="email" autocomplete="email" required placeholder="you@example.com"
                      class="mt-1 w-full rounded-xl px-4 py-3 bg-white/10 border border-accent-400/40 focus:border-accent-400 focus:ring-0 outline-none transition text-base"
                      aria-describedby="emailHelp">
                  </label>
                  <p id="emailHelp" class="text-xs text-accent-200/80">We’ll send a one-time code to this email.</p>
                  <div class="flex items-center gap-3">
                    <button type="submit"
                      class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-accent-600 text-white shadow-neon hover:brightness-110 transition">
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M3 12l7-7m0 0v4a6 6 0 006 6h5M10 5l7 7" stroke="currentColor" stroke-width="1.6"
                          stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                      Send code
                    </button>
                    <span id="emailStatus" class="text-sm text-accent-200/90" aria-live="polite"></span>
                  </div>
                </form>
                <form id="form-email-otp" class="space-y-4 hidden" novalidate>
                  <p class="text-sm">Enter the 6-digit code we sent to your email.</p>
                  <div class="flex gap-2 sm:gap-3" aria-label="One-time passcode">
                    <input class="otp-input" inputmode="numeric" maxlength="1" aria-label="Digit 1">
                    <input class="otp-input" inputmode="numeric" maxlength="1" aria-label="Digit 2">
                    <input class="otp-input" inputmode="numeric" maxlength="1" aria-label="Digit 3">
                    <input class="otp-input" inputmode="numeric" maxlength="1" aria-label="Digit 4">
                    <input class="otp-input" inputmode="numeric" maxlength="1" aria-label="Digit 5">
                    <input class="otp-input" inputmode="numeric" maxlength="1" aria-label="Digit 6">
                  </div>
                  <div class="flex items-center gap-3">
                    <button type="submit"
                      class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-accent-600 text-white shadow-neon hover:brightness-110 transition">Verify</button>
                    <button type="button" id="resendEmail"
                      class="text-sm underline decoration-accent-400/70 decoration-2 underline-offset-4 hover:text-accent-200">Resend
                      code</button>
                    <span id="otpStatus" class="text-sm text-accent-200/90" aria-live="polite"></span>
                  </div>
                </form>
              </div>

              <!-- Biometric Panel -->
              <div id="panel-biometric" class="hidden">
                <div class="space-y-4">
                  <p class="text-sm">Use your device’s built-in biometric authentication to continue.</p>
                  <div class="flex items-center gap-3">
                    <button id="btnBiometric" type="button"
                      class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-accent-600 text-white shadow-neon hover:brightness-110 transition">
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M12 2a7 7 0 00-7 7v2a7 7 0 1014 0V9a7 7 0 00-7-7z" stroke="currentColor"
                          stroke-width="1.6" />
                        <path d="M8 11a4 4 0 108 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                      </svg>
                      Use FaceID / TouchID
                    </button>
                    <span id="bioStatus" class="text-sm text-accent-200/90" aria-live="polite"></span>
                  </div>
                  <p class="text-xs text-accent-200/80">If unsupported, choose another method.</p>
                </div>
              </div>

              <!-- Backup Phrase Panel -->
              <div id="panel-phrase" class="hidden">
                <form id="form-phrase" class="space-y-4" novalidate>
                  <label class="block">
                    <span class="text-sm font-medium">Recovery phrase</span>
                    <textarea required rows="3" placeholder="Enter your 12–24 word recovery phrase"
                      class="mt-1 w-full rounded-xl px-4 py-3 bg-white/10 border border-accent-400/40 focus:border-accent-400 focus:ring-0 outline-none transition text-base"></textarea>
                  </label>
                  <div class="flex items-center gap-3">
                    <button type="submit"
                      class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-accent-600 text-white shadow-neon hover:brightness-110 transition">Verify
                      phrase</button>
                    <span id="phraseStatus" class="text-sm text-accent-200/90" aria-live="polite"></span>
                  </div>
                </form>
              </div>

              <!-- Authenticator Panel -->
              <div id="panel-authapp" class="hidden">
                <form id="form-authapp" class="space-y-4" novalidate>
                  <label class="block">
                    <span class="text-sm font-medium">6-digit code</span>
                    <input type="text" inputmode="numeric" pattern="\\d{6}" maxlength="6" required placeholder="••••••"
                      class="mt-1 w-40 rounded-xl px-4 py-3 bg-white/10 border border-accent-400/40 focus:border-accent-400 focus:ring-0 outline-none transition text-base tracking-widest text-center">
                  </label>
                  <div class="flex items-center gap-3">
                    <button type="submit"
                      class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-accent-600 text-white shadow-neon hover:brightness-110 transition">Verify</button>
                    <span id="authStatus" class="text-sm text-accent-200/90" aria-live="polite"></span>
                  </div>
                  <p class="text-xs text-accent-200/80">Time-based codes refresh every 30 seconds in your app.</p>
                </form>
              </div>
            </div>
          </div>

          <!-- Reset Password Step -->
          <div id="step-reset" class="hidden mt-8">
            <div class="rounded-2xl p-5 border border-accent-400/30 bg-white/5">
              <h3 class="text-lg sm:text-xl font-semibold mb-4">Create a new password</h3>
              <form id="form-reset" class="space-y-4" novalidate>
                <div class="grid sm:grid-cols-2 gap-4">
                  <label class="block">
                    <span class="text-sm font-medium">New password</span>
                    <div class="mt-1 relative">
                      <input id="newPass" type="password" required autocomplete="new-password"
                        aria-describedby="passHelp"
                        class="w-full rounded-xl px-4 py-3 bg-white/10 border border-accent-400/40 focus:border-accent-400 focus:ring-0 outline-none transition text-base pr-12">
                      <button type="button" id="togglePass"
                        class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-white/10 border border-white/10 hover:bg-white/20"
                        aria-label="Toggle password visibility">
                        <svg id="eyeIcon" class="w-5 h-5 text-accent-200" viewBox="0 0 24 24" fill="none"
                          aria-hidden="true">
                          <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z" stroke="currentColor"
                            stroke-width="1.6" />
                          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.6" />
                        </svg>
                      </button>
                    </div>
                    <p id="passHelp" class="text-xs text-accent-200/80 mt-1">Use at least 8 characters, including upper,
                      lower, number, and symbol.</p>
                  </label>
                  <label class="block">
                    <span class="text-sm font-medium">Confirm password</span>
                    <input id="confirmPass" type="password" required autocomplete="new-password"
                      class="mt-1 w-full rounded-xl px-4 py-3 bg-white/10 border border-accent-400/40 focus:border-accent-400 focus:ring-0 outline-none transition text-base">
                  </label>
                </div>

                <div>
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium">Strength</span>
                    <span id="strengthLabel" class="text-xs text-accent-200/90">—</span>
                  </div>
                  <div class="strength-bar">
                    <div id="strengthFill" class="strength-fill"></div>
                  </div>
                </div>

                <div class="flex flex-wrap items-center gap-3">
                  <button type="button" id="btnSuggest"
                    class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-white/10 border border-accent-400/40 text-accent-50 hover:bg-white/20 transition shadow-neo-sm">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                      <path
                        d="M12 3v3M12 18v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M3 12h3M18 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12"
                        stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                    </svg>
                    Suggest strong password
                  </button>
                  <code id="suggestion" class="text-xs px-2 py-1 rounded bg-white/10 border border-white/10"></code>
                </div>

                <div class="flex items-center gap-2 mt-4">
                  <input id="ackKey" type="checkbox" class="h-4 w-4 rounded border-accent-400/40 bg-white/10">
                  <label for="ackKey" class="text-xs text-accent-200/90">I have stored my one-time recovery key
                    safely.</label>
                  <button type="button" id="btnShowKey"
                    class="ml-auto text-xs underline decoration-accent-400/70 decoration-2 underline-offset-4 hover:text-accent-200">Generate
                    recovery key</button>
                </div>

                <div id="recoveryKeyWrap" class="hidden mt-3">
                  <div
                    class="rounded-xl p-3 border border-accent-400/30 bg-white/5 flex items-center justify-between gap-3">
                    <div class="flex items-center gap-2">
                      <svg class="w-5 h-5 text-accent-200" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M12 3l9 4.5v9L12 21 3 16.5v-9L12 3z" stroke="currentColor" stroke-width="1.6" />
                        <path d="M9 12h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                      </svg>
                      <span class="text-sm">Your recovery key:</span>
                    </div>
                    <code id="recoveryKey"
                      class="text-xs px-2 py-1 rounded bg-white/10 border border-white/10 select-all"></code>
                  </div>
                </div>

                <div class="pt-2">
                  <button id="btnReset" type="submit"
                    class="inline-flex items-center gap-2 rounded-2xl px-5 py-3 bg-accent-600 text-white shadow-neon hover:brightness-110 transition disabled:opacity-60 disabled:cursor-not-allowed"
                    disabled>
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                      <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                        stroke-linejoin="round" />
                    </svg>
                    Reset password
                  </button>
                  <span id="resetStatus" class="ml-3 text-sm text-accent-200/90" aria-live="polite"></span>
                </div>
              </form>
            </div>
          </div>

          <!-- Final Secure Step -->
          <div id="step-secure" class="hidden mt-8">
            <div
              class="rounded-3xl p-8 border border-accent-400/30 bg-gradient-to-br from-white/5 to-transparent text-center">
              <div class="flex items-center justify-center mb-5">
                <svg id="lockIcon" class="lock" viewBox="0 0 80 100" fill="none" role="img" aria-label="Lock">
                  <g class="shackle">
                    <path d="M25 35a15 15 0 1130 0v10" stroke="url(#gradLock)" stroke-width="6"
                      stroke-linecap="round" />
                  </g>
                  <rect x="15" y="40" width="50" height="50" rx="10" stroke="url(#gradLock)" stroke-width="6"
                    fill="rgba(139,92,246,0.08)" />
                  <circle cx="40" cy="65" r="4" fill="url(#gradLock)" />
                  <defs>
                    <linearGradient id="gradLock" x1="0" y1="0" x2="1" y2="1">
                      <stop offset="0%" stop-color="#a78bfa" />
                      <stop offset="100%" stop-color="#8b5cf6" />
                    </linearGradient>
                  </defs>
                </svg>
              </div>
              <h3 class="text-xl sm:text-2xl font-bold mb-2">Your password has been successfully reset</h3>
              <p class="text-accent-200/90 mb-6">You can now use your new password to sign in securely.</p>
              <div class="flex items-center justify-center gap-3">
                <a href="login.html"
                  class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-white/10 border border-accent-400/40 text-accent-50 hover:bg-white/20 transition shadow-neo-sm">
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M4 12l6-6M4 12h12M10 6v12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                  Back to sign in
                </a>
                <button id="downloadKey" type="button"
                  class="inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-accent-600 text-white shadow-neon hover:brightness-110 transition">
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 3v12m0 0l-4-4m4 4l4-4M5 21h14" stroke="currentColor" stroke-width="1.6"
                      stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  Download recovery key
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>
  </main>

  <footer class="relative z-10 pb-10 pt-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center text-xs text-accent-200/80">
      <p>&copy; <span id="year"></span> Salmar AI. Stay secure.</p>
    </div>
  </footer>

  <script>
    // Utilities and State
    const qs = (s, el = document) => el.querySelector(s);
    const qsa = (s, el = document) => Array.from(el.querySelectorAll(s));
    const card = qs('#card');
    const guidance = qs('#guidanceText');
    const progressFill = qs('#progressFill');
    const stepVerify = qs('#step-verify');
    const stepReset = qs('#step-reset');
    const stepSecure = qs('#step-secure');
    const year = qs('#year');
    year.textContent = new Date().getFullYear();

    let currentStep = 0; // 0=verify,1=reset,2=secure
    let selectedMethod = null;
    let lastGeneratedKey = '';

    // Theme toggle removed; dark theme enforced via <html data-theme="dark">

    // Device & location check
    const secMsg = qs('#securityMsg');
    const devChip = qs('#deviceChip');
    const osChip = qs('#osChip');
    const tzChip = qs('#tzChip');
    const locChip = qs('#locChip');
    const deviceHint = qs('#deviceHint');

    (function securityCheck() {
      const ua = navigator.userAgent;
      const platform = navigator.platform || '—';
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '—';
      devChip.textContent = 'Device: ' + (navigator.userAgentData?.platform || platform);
      osChip.textContent = 'OS: ' + (navigator.userAgentData?.platform || (platform.includes('Win') ? 'Windows' : platform.includes('Mac') ? 'macOS' : platform.includes('Linux') ? 'Linux' : 'Unknown'));
      tzChip.textContent = 'TZ: ' + tz;

      deviceHint.textContent = (navigator.userAgentData?.mobile || /Mobi|Android/i.test(ua)) ? 'Mobile device detected' : 'Desktop device detected';

      // Attempt geolocation for a gentle check
      let warned = false;
      try {
        if ('geolocation' in navigator) {
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              const { latitude, longitude } = pos.coords;
              locChip.textContent = `Location: ${latitude.toFixed(2)}, ${longitude.toFixed(2)}`;
              secMsg.textContent = 'Device and approximate location verified.';
            },
            (err) => {
              locChip.textContent = 'Location: permission denied';
              secMsg.textContent = 'Could not verify location. If this is not your usual device, proceed with caution.';
              warned = true;
            },
            { maximumAge: 60_000, timeout: 8000 }
          );
        } else {
          locChip.textContent = 'Location: unavailable';
          secMsg.textContent = 'Location services unavailable. Continue with enhanced verification.';
          warned = true;
        }
      } catch (e) {
        locChip.textContent = 'Location: error';
        secMsg.textContent = 'Location detection error. Continue with enhanced verification.';
        warned = true;
      }
      if (warned) {
        // soft highlight
        qs('#securityBanner').classList.add('card-glow');
        setTimeout(() => qs('#securityBanner').classList.remove('card-glow'), 1600);
      }
    })();

    // Progress control
    function setStep(step) {
      currentStep = step;
      const pct = step === 0 ? 10 : step === 1 ? 55 : 100;
      progressFill.style.width = pct + '%';
      qs('.progress-track').setAttribute('aria-valuenow', pct);

      if (step === 0) guidance.textContent = 'Step 1: Verify your identity.';
      if (step === 1) guidance.textContent = 'Step 2: Secure your account with a new password.';
      if (step === 2) guidance.textContent = 'All set. Your account is secure.';

      // glow effect on card
      card.classList.add('card-glow');
      setTimeout(() => card.classList.remove('card-glow'), 1500);

      // toggle sections
      stepVerify.classList.toggle('hidden', step !== 0);
      stepReset.classList.toggle('hidden', step !== 1);
      stepSecure.classList.toggle('hidden', step !== 2);
    }
    setStep(0);

    // Method selection handling
    const methodButtons = qsa('.method-btn');
    const panels = {
      email: qs('#panel-email'),
      biometric: qs('#panel-biometric'),
      phrase: qs('#panel-phrase'),
      authapp: qs('#panel-authapp')
    };

    function selectMethod(method) {
      selectedMethod = method;
      methodButtons.forEach(btn => btn.setAttribute('aria-selected', String(btn.dataset.method === method)));
      Object.keys(panels).forEach(k => panels[k].classList.toggle('hidden', k !== method));
      // Scroll into view for smaller screens
      panels[method].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    methodButtons.forEach(btn => {
      btn.addEventListener('click', () => selectMethod(btn.dataset.method));
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectMethod(btn.dataset.method); }
      });
    });

    // Email flow
    const formEmail = qs('#form-email');
    const formEmailOtp = qs('#form-email-otp');
    const emailStatus = qs('#emailStatus');
    const otpStatus = qs('#otpStatus');
    const resendEmail = qs('#resendEmail');
    let mockOTP = '';

    formEmail?.addEventListener('submit', (e) => {
      e.preventDefault();
      emailStatus.textContent = 'Sending code...';
      setTimeout(() => {
        mockOTP = generateMockCode(6);
        emailStatus.textContent = 'Code sent. Check your inbox.';
        formEmail.classList.add('hidden');
        formEmailOtp.classList.remove('hidden');
        // For demo: hint the code in title attribute
        formEmailOtp.title = 'Demo code: ' + mockOTP;
        focusOtp(0);
      }, 900);
    });
    resendEmail?.addEventListener('click', () => {
      otpStatus.textContent = 'Resending...';
      setTimeout(() => {
        mockOTP = generateMockCode(6);
        otpStatus.textContent = 'New code sent. (Hint in tooltip)';
        formEmailOtp.title = 'Demo code: ' + mockOTP;
      }, 900);
    });

    // OTP fields
    const otpInputs = qsa('.otp-input', formEmailOtp);
    function focusOtp(i) { if (otpInputs[i]) otpInputs[i].focus(); }
    otpInputs.forEach((el, idx) => {
      el.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/\\D/g, '').slice(0, 1);
        if (e.target.value && idx < otpInputs.length - 1) focusOtp(idx + 1);
        if (otpInputs.every(i => i.value.length === 1)) {
          // Auto-submit
          formEmailOtp.requestSubmit();
        }
      });
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && !e.target.value && idx > 0) {
          focusOtp(idx - 1);
        }
      });
      // Paste support
      el.addEventListener('paste', (e) => {
        const txt = (e.clipboardData || window.clipboardData).getData('text').replace(/\\D/g, '').slice(0, 6);
        if (txt) {
          e.preventDefault();
          otpInputs.forEach((inp, i) => inp.value = txt[i] || '');
          if (txt.length === 6) formEmailOtp.requestSubmit();
        }
      });
    });

    formEmailOtp?.addEventListener('submit', (e) => {
      e.preventDefault();
      const code = otpInputs.map(i => i.value).join('');
      otpStatus.textContent = 'Verifying...';
      setTimeout(() => {
        if (code === mockOTP && code.length === 6) {
          otpStatus.textContent = 'Verified ✓';
          setStep(1);
        } else {
          otpStatus.textContent = 'Invalid code. Try again.';
          otpInputs.forEach(i => i.value = '');
          focusOtp(0);
        }
      }, 900);
    });

    // Biometric flow (WebAuthn)
    const btnBiometric = qs('#btnBiometric');
    const bioStatus = qs('#bioStatus');
    btnBiometric?.addEventListener('click', async () => {
      bioStatus.textContent = 'Checking device...';
      if (!('credentials' in navigator) || !('PublicKeyCredential' in window)) {
        bioStatus.textContent = 'Biometrics not supported on this device.';
        return;
      }
      try {
        bioStatus.textContent = 'Prompting biometric...';
        // Demo dummy challenge/publicKey. In production, values come from server.
        const assertion = await navigator.credentials.get({
          publicKey: {
            challenge: new Uint8Array(32),
            timeout: 60_000,
            userVerification: 'preferred',
            allowCredentials: [] // let platform choose
          }
        });
        if (assertion) {
          bioStatus.textContent = 'Verified ✓';
          setStep(1);
        } else {
          bioStatus.textContent = 'Verification canceled.';
        }
      } catch (err) {
        bioStatus.textContent = 'Biometric failed or canceled. Try another method.';
      }
    });

    // Backup phrase flow
    const formPhrase = qs('#form-phrase');
    const phraseStatus = qs('#phraseStatus');
    formPhrase?.addEventListener('submit', (e) => {
      e.preventDefault();
      const text = formPhrase.querySelector('textarea').value.trim().replace(/\\s+/g, ' ');
      const words = text ? text.split(' ') : [];
      phraseStatus.textContent = 'Validating phrase...';
      setTimeout(() => {
        if (words.length >= 12) {
          phraseStatus.textContent = 'Phrase accepted ✓';
          setStep(1);
        } else {
          phraseStatus.textContent = 'Phrase seems too short. Use your 12–24 word recovery phrase.';
        }
      }, 800);
    });

    // Authenticator flow
    const formAuth = qs('#form-authapp');
    const authStatus = qs('#authStatus');
    formAuth?.addEventListener('submit', (e) => {
      e.preventDefault();
      const val = formAuth.querySelector('input').value.trim();
      authStatus.textContent = 'Verifying...';
      setTimeout(() => {
        if (/^\\d{6}$/.test(val)) {
          authStatus.textContent = 'Verified ✓';
          setStep(1);
        } else {
          authStatus.textContent = 'Invalid code. Please enter a 6-digit code.';
        }
      }, 900);
    });

    // Password strength and reset
    const newPass = qs('#newPass');
    const confirmPass = qs('#confirmPass');
    const strengthFill = qs('#strengthFill');
    const strengthLabel = qs('#strengthLabel');
    const btnReset = qs('#btnReset');
    const resetStatus = qs('#resetStatus');

    function updateStrength() {
      const pwd = newPass.value;
      let score = 0;
      let feedback = '';
      if (window.zxcvbn) {
        const r = zxcvbn(pwd);
        score = r.score; // 0..4
        feedback = r.feedback.warning || r.feedback.suggestions?.[0] || '';
      } else {
        // Fallback heuristic
        score = Math.min(4, Math.floor((pwd.length / 3)) + (/[A-Z]/.test(pwd)) + (/[0-9]/.test(pwd)) + (/[\\W_]/.test(pwd)));
      }
      const pct = [10, 30, 55, 78, 100][score] || 10;
      strengthFill.style.width = pct + '%';
      strengthFill.style.filter = `saturate(${60 + score * 20}%)`;
      strengthFill.style.boxShadow = score >= 3 ? '0 0 18px rgba(20,184,166,0.55)' : '0 0 12px rgba(234,179,8,0.45)';
      const labels = ['Very weak', 'Weak', 'Fair', 'Strong', 'Excellent'];
      strengthLabel.textContent = labels[score] + (feedback ? ' — ' + feedback : '');
      validateReset();
    }

    function validateReset() {
      const okMatch = newPass.value && confirmPass.value && newPass.value === confirmPass.value;
      const strongEnough = strengthFill.style.width.replace('%', '') >= 55; // at least "Strong"
      const ack = qs('#ackKey').checked;
      btnReset.disabled = !(okMatch && strongEnough && ack);
    }
    newPass?.addEventListener('input', updateStrength);
    confirmPass?.addEventListener('input', validateReset);
    qs('#ackKey')?.addEventListener('change', validateReset);

    // Toggle password visibility
    const togglePass = qs('#togglePass');
    const eyeIcon = qs('#eyeIcon');
    togglePass?.addEventListener('click', () => {
      const isPwd = newPass.type === 'password';
      newPass.type = isPwd ? 'text' : 'password';
      confirmPass.type = isPwd ? 'text' : 'password';
      eyeIcon.innerHTML = isPwd
        ? '<path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><path d="M10.58 10.58A3 3 0 0012 15a3 3 0 002.95-2.42M9.88 5.09C10.56 5.03 11.27 5 12 5c6.5 0 10 7 10 7a16.7 16.7 0 01-3.27 4.11M6.12 6.12A16.7 16.7 0 002 12s3.5 7 10 7c1.18 0 2.28-.18 3.29-.5" stroke="currentColor" stroke-width="1.6" fill="none"/>'
        : '<path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="1.6"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.6"/>';
    });

    // Password Suggestion
    const btnSuggest = qs('#btnSuggest');
    const suggestion = qs('#suggestion');
    btnSuggest?.addEventListener('click', async () => {
      const generated = await securePasswordSuggestion();
      suggestion.textContent = generated;
      newPass.value = generated;
      confirmPass.value = generated;
      updateStrength();
      validateReset();
    });

    async function securePasswordSuggestion() {
      const length = 16;
      const charset = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%^&*()-_=+[]{}';
      let arr = new Uint32Array(length);
      if (window.crypto && crypto.getRandomValues) {
        crypto.getRandomValues(arr);
      } else {
        // fallback to Math.random
        arr = Uint32Array.from({ length }, () => Math.floor(Math.random() * 0xffffffff));
      }
      let pwd = '';
      for (let i = 0; i < length; i++) {
        pwd += charset[arr[i] % charset.length];
      }
      return pwd;
    }

    // Recovery key generation
    const btnShowKey = qs('#btnShowKey');
    const recoveryWrap = qs('#recoveryKeyWrap');
    const recoveryKeyEl = qs('#recoveryKey');
    btnShowKey?.addEventListener('click', async () => {
      recoveryWrap.classList.remove('hidden');
      lastGeneratedKey = await generateRecoveryKey();
      recoveryKeyEl.textContent = lastGeneratedKey;
      validateReset();
    });

    async function generateRecoveryKey() {
      const bytes = new Uint8Array(20);
      if (crypto && crypto.getRandomValues) crypto.getRandomValues(bytes);
      const base32 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
      let bits = '';
      bytes.forEach(b => bits += b.toString(2).padStart(8, '0'));
      let out = '';
      for (let i = 0; i < bits.length; i += 5) {
        const chunk = bits.slice(i, i + 5);
        if (chunk.length < 5) break;
        out += base32[parseInt(chunk, 2)];
      }
      // Group into readable blocks
      return out.slice(0, 32).match(/.{1,4}/g).join('-');
    }

    // Reset submit
    qs('#form-reset')?.addEventListener('submit', (e) => {
      e.preventDefault();
      resetStatus.textContent = 'Securing account...';
      btnReset.disabled = true;
      setTimeout(() => {
        resetStatus.textContent = 'Password updated ✓';
        unlockAnimation();
        setStep(2);
      }, 1200);
    });

    // Final lock/unlock flourish
    function unlockAnimation() {
      const lock = qs('#lockIcon');
      if (!lock) return;
      lock.classList.add('unlocked');
      // Burst particles via anime.js
      if (window.anime) {
        const burstContainer = document.createElement('div');
        burstContainer.style.position = 'fixed';
        burstContainer.style.inset = '0';
        burstContainer.style.pointerEvents = 'none';
        burstContainer.style.zIndex = '20';
        document.body.appendChild(burstContainer);

        for (let i = 0; i < 24; i++) {
          const dot = document.createElement('div');
          dot.style.position = 'absolute';
          dot.style.left = '50%';
          dot.style.top = '42%';
          dot.style.width = '8px';
          dot.style.height = '8px';
          dot.style.borderRadius = '9999px';
          dot.style.background = i % 2 === 0 ? '#a78bfa' : '#8b5cf6';
          dot.style.boxShadow = '0 0 12px rgba(167,139,250,0.7)';
          burstContainer.appendChild(dot);
          const angle = (Math.PI * 2) * (i / 24);
          const dist = 80 + Math.random() * 80;
          anime({
            targets: dot,
            translateX: Math.cos(angle) * dist,
            translateY: Math.sin(angle) * dist,
            scale: [{ value: 1 }, { value: 0, delay: 200 }],
            opacity: [{ value: 1 }, { value: 0, delay: 150 }],
            easing: 'easeOutExpo',
            duration: 1200 + Math.random() * 400,
            complete: () => dot.remove()
          });
        }
        setTimeout(() => burstContainer.remove(), 2000);
      }
    }

    // Download recovery key (txt)
    qs('#downloadKey')?.addEventListener('click', () => {
      const content = lastGeneratedKey ? lastGeneratedKey : 'No recovery key generated in this session.';
      const blob = new Blob([`Salmar AI — Recovery Key\n\n${content}\n\nKeep this key safe and private.`], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'salmarai-recovery-key.txt';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(url);
        a.remove();
      }, 0);
    });

    // Background particles
    const canvas = qs('#particles');
    const ctx = canvas.getContext('2d', { alpha: true, desynchronized: true });
    let dpr = Math.max(1, window.devicePixelRatio || 1);
    let W, H;
    function resizeCanvas() {
      W = canvas.clientWidth = window.innerWidth;
      H = canvas.clientHeight = window.innerHeight;
      canvas.width = Math.floor(W * dpr);
      canvas.height = Math.floor(H * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas, { passive: true });

    const particles = Array.from({ length: 60 }, () => ({
      x: Math.random() * W,
      y: Math.random() * H,
      r: Math.random() * 1.8 + 0.6,
      s: Math.random() * 0.4 + 0.1,
      a: Math.random() * Math.PI * 2
    }));

    function drawParticles() {
      ctx.clearRect(0, 0, W, H);
      for (const p of particles) {
        p.a += 0.002 + p.s * 0.002;
        p.x += Math.cos(p.a) * p.s;
        p.y += Math.sin(p.a) * p.s * 0.6;
        // wrap
        if (p.x < -5) p.x = W + 5; if (p.x > W + 5) p.x = -5;
        if (p.y < -5) p.y = H + 5; if (p.y > H + 5) p.y = -5;

        const grd = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 8);
        grd.addColorStop(0, 'rgba(167,139,250,0.8)');
        grd.addColorStop(1, 'rgba(167,139,250,0)');
        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r * 2, 0, Math.PI * 2);
        ctx.fill();
      }
      requestAnimationFrame(drawParticles);
    }
    drawParticles();

    // Helper
    function generateMockCode(n = 6) {
      let s = '';
      for (let i = 0; i < n; i++) s += Math.floor(Math.random() * 10);
      return s;
    }
  </script>
</body>

</html>