<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salmar â€” The AI That Does Everything | Login</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Cloudflare Turnstile (CAPTCHA) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" integrity="sha512-f2M8+dF6qUqBqLMF+Xz2oPPKocK/2r5v9f8DO/vyGaTnQwo0YWZ5B6CGeSUX7lM2o5iFQkX2+7x7C3gSqcE4XA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Three.js for 3D orb -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r155/three.min.js" integrity="sha512-2l9Qh26/e3pA8qnmncEl1svbw21Y2GZ0t3+3/Qm3X8F7F4Ww+0W8hEAY2uS8/KFxtwwnlrCL0xq3X8p5kN1q9Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    /* CSS Variables for themes */
    :root {
      /* copied from signup page for parity */
      --bg: #0b0614;
      --bg-2: #110a22;
      --text: #F4F3FF;
      --muted: #CFC7FF;
      --card: rgba(255,255,255,0.06);
      --card-strong: rgba(255,255,255,0.12);
      --outline: rgba(202, 191, 253, 0.45);
      --accent: #9A6CFF;
      --accent-2: #CF28FF;
      --accent-3: #8A2BE2;
      --shadow-strong: 0 10px 30px rgba(107, 61, 252, 0.25), 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-soft: 0 8px 24px rgba(165, 108, 255, 0.25), inset 0 1px 0 rgba(255,255,255,0.08);
      --ring: 0 0 0 3px rgba(154,108,255,0.35);
    }
    .theme-light {
      --bg-1: #f6f2ff;
      --bg-2: #eae0ff;
      --bg-3: #d8c6ff;
      --accent: #6b3dfc;
      --accent-2: #8a2cff;
      --text: #231a3a;
      --muted: #4a3f66;
      --glass: rgba(255, 255, 255, 0.55);
      --glass-border: rgba(107, 61, 252, 0.25);
      --shadow-strong: 0 10px 30px rgba(107, 61, 252, 0.25), 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-soft: 0 8px 24px rgba(107, 61, 252, 0.15), inset 0 1px 0 rgba(255,255,255,0.65);
      --ring: 0 0 0 3px rgba(107, 61, 252, 0.35);
      --outline: rgba(107,61,252,.65);
    }

    /* Global resets and typography */
    html, body {
      height: 100%;
      background: linear-gradient(180deg, var(--bg), #06040a) !important;
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow: hidden;
    }
    body:focus-within {
      outline: none;
    }

    /* Subtle noise overlay */
    .noise-overlay { display: none !important; }

    /* Flowing nebula gradient animation */
    .nebula { display: none !important; }

    /* Particle canvas */
    #particles { display: none !important; }

    /* Three.js orb canvas */
    #orbCanvas { display: none !important; }

    /* Ripple overlay for biometric acknowledgment */
    .ripple-overlay {
      position: fixed;
      inset: 0;
      z-index: 4;
      pointer-events: none;
      background: radial-gradient(closest-side, rgba(165,108,255,0.25), transparent 70%) center/0% 0% no-repeat;
      opacity: 0;
    }

    /* Split layout and form */
    .container {
      position: relative;
      z-index: 5;
      display: flex;
      align-items: center;           /* vertical center */
      justify-content: flex-start;   /* push form to the left */
      min-height: 100vh;
      padding: 1.5rem;
      padding-left: 10vw;            /* nudge form a bit more right */
      width: 50vw;
      margin-right: 50vw; /* form on left */
    }
    .glass-card { width: 100%; max-width: 28rem; background: transparent; border: none; box-shadow: none; animation: none; }
    @keyframes floaty { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-6px) } }
    .glass-card::before { content: none; }
    /* RIGHT logo panel (stage) */
    .logo-panel {
      position: fixed;
      inset: 0 0 0 auto; /* stick to right half */
      width: 50vw;
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
      background: #0b0b0b; /* dark base to match mock */
    }
    /* spotlight + vignette layers */
    .logo-panel::before {
      content: "";
      position: absolute; inset: -10% -10% -10% -10%;
      background:
        radial-gradient(100% 60% at 50% 50%, rgba(255,255,255,0.06), rgba(0,0,0,0) 60%),
        linear-gradient(90deg, rgba(0,0,0,0.75), rgba(0,0,0,0.25) 40%, rgba(0,0,0,0));
      filter: saturate(110%);
      z-index: 0;
    }
    .logo-panel::after {
      content: "";
      position: absolute; top: -10%; right: -25%; bottom: -10%; width: 55%;
      background: radial-gradient(closest-side, rgba(255,255,255,0.2), rgba(255,255,255,0.06) 60%, rgba(0,0,0,0) 100%);
      transform: rotate(-4deg);
      filter: blur(24px) saturate(110%);
      opacity: .85;
      z-index: 0;
    }
    .logo-panel img {
      position: absolute; inset: 0; margin: auto; right: 8%;
      height: min(82vh, 880px); width: auto;
      opacity: .18;
      filter: contrast(1.15) saturate(1.05) drop-shadow(0 8px 40px rgba(0,0,0,.5));
      z-index: 1;
      mix-blend-mode: normal;
    }
    @media (max-width: 768px) {
      .logo-panel { display: none; }
      .container { width: 100vw; margin-right: 0; }
    }
    .inner {
      position: relative;
      padding: 1.75rem 1.5rem 1.5rem;
    }

    /* Top orb logo */
    .logo-orb {
      width: 64px;
      height: 64px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fff 0%, var(--accent) 15%, rgba(165,108,255,0.35) 35%, rgba(0,0,0,0) 70%);
      box-shadow:
        0 0 24px rgba(165,108,255,0.75),
        inset 0 0 22px rgba(255,255,255,0.65);
      position: relative;
      margin: 0 auto 0.5rem;
      transition: transform .6s ease, filter .6s ease;
      filter: saturate(120%);
    }
    .logo-orb::after {
      content: "";
      position: absolute;
      inset: -3px;
      border-radius: inherit;
      background: conic-gradient(from 45deg, rgba(165,108,255,0.8), rgba(138,44,255,0.6), rgba(255,255,255,0.5), rgba(165,108,255,0.8));
      filter: blur(16px);
      opacity: .35;
      z-index: -1;
    }
    .logo-orb.unlocked {
      transform: scale(1.08);
      filter: drop-shadow(0 0 26px rgba(165,108,255,.95)) saturate(150%);
    }

    /* Inputs */
    .field {
      position: relative;
    }
    .field input {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(165,108,255,0.35);
      color: var(--text);
      border-radius: 0.875rem;
      width: 100%;
      padding: 0.875rem 3rem 0.875rem 0.875rem;
      outline: none;
      box-shadow: var(--shadow-soft);
      transition: box-shadow .25s ease, border-color .25s ease, background-color .25s ease;
    }
    .field input::placeholder {
      color: color-mix(in oklab, var(--text) 35%, transparent);
    }
    .field input:focus {
      border-color: var(--accent);
      box-shadow: var(--shadow-soft), var(--ring);
      background: rgba(255,255,255,0.12);
    }
    .field .spark-area {
      pointer-events: none;
      position: absolute;
      inset: 0;
      overflow: hidden;
      border-radius: inherit;
    }
    .spark {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fff, var(--accent));
      box-shadow: 0 0 10px var(--accent);
      opacity: 0.95;
      filter: saturate(140%);
    }

    /* Password toggle */
    .toggle-pass {
      position: absolute;
      top: 50%;
      right: 0.5rem;
      transform: translateY(-50%);
      display: grid;
      place-items: center;
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 999px;
      color: var(--muted);
      transition: background .2s ease, color .2s ease;
      cursor: pointer;
    }
    .toggle-pass:hover {
      background: rgba(165,108,255,0.15);
      color: var(--text);
    }

    /* Buttons */
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: white;
      border: none;
      width: 100%;
      padding: 0.9rem 1.25rem;
      border-radius: 0.95rem;
      font-weight: 700;
      letter-spacing: .2px;
      box-shadow: 0 8px 24px rgba(165,108,255,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
      position: relative;
      overflow: hidden;
    }
    .btn-primary::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(200px 60px at var(--mx, 50%) var(--my, 50%), rgba(255,255,255,0.25), transparent 60%);
      opacity: 0;
      transition: opacity .2s ease;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(165,108,255,0.55);
      filter: saturate(115%);
    }
    .btn-primary:hover::after { opacity: 1; }
    .btn-primary.pulse {
      animation: pulseGlow 2s ease-in-out infinite;
    }
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 8px 24px rgba(165,108,255,0.35), inset 0 1px 0 rgba(255,255,255,0.2); }
      50% { box-shadow: 0 12px 36px rgba(165,108,255,0.6), inset 0 1px 0 rgba(255,255,255,0.25); }
    }

    .btn-social {
      display: grid;
      place-items: center;
      width: 2.75rem;
      height: 2.75rem;
      border-radius: 0.85rem;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(165,108,255,0.35);
      color: var(--text);
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: var(--shadow-soft);
    }
    .btn-social:hover {
      transform: translateY(-2px);
      background: rgba(255,255,255,0.18);
      box-shadow: 0 8px 24px rgba(165,108,255,0.35);
    }

    /* Divider */
    .divider {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: .75rem;
      color: var(--muted);
      margin: .25rem 0 0.5rem;
    }
    .divider::before, .divider::after {
      content: "";
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(165,108,255,0.45), transparent);
    }

    /* Biometric section */
    .biometric {
      display: grid;
      grid-template-columns: 1fr;
      gap: .75rem;
      justify-items: center;
    }
    .bio-actions {
      display: flex;
      gap: 0.75rem;
    }
    .bio-btn {
      position: relative;
      display: grid;
      place-items: center;
      width: 3.25rem;
      height: 3.25rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(165,108,255,0.45);
      box-shadow: var(--shadow-soft);
      color: var(--text);
      overflow: hidden;
      transition: transform .2s ease, box-shadow .2s ease, background .2s ease;
      cursor: pointer;
      isolation: isolate;
    }
    .bio-btn:hover {
      transform: translateY(-2px);
      background: rgba(255,255,255,0.16);
      box-shadow: 0 10px 28px rgba(165,108,255,0.35);
    }
    .bio-btn::after {
      content: "";
      position: absolute;
      width: 0;
      height: 0;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(165,108,255,0.35), transparent 65%);
      opacity: 0;
      transform: scale(0.1);
      transition: opacity .2s ease, transform .25s ease;
      z-index: -1;
    }
    .bio-btn:hover::after {
      opacity: 1;
      width: 280%;
      height: 280%;
      transform: scale(1);
    }

    /* Face ID scanning ring */
    .face-ring {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      border: 2px solid rgba(165,108,255,0.65);
      box-shadow: inset 0 0 12px rgba(165,108,255,0.45), 0 0 10px rgba(165,108,255,0.4);
      animation: scan 2.2s linear infinite;
      opacity: .55;
      pointer-events: none;
    }
    @keyframes scan {
      0% { clip-path: polygon(50% 0, 52% 0, 52% 100%, 50% 100%); }
      50% { clip-path: polygon(0 48%, 100% 48%, 100% 52%, 0 52%); }
      100% { clip-path: polygon(48% 0, 50% 0, 50% 100%, 48% 100%); }
    }

    /* Links (CTA gradient text, underline on hover only) */
    a.link {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      position: relative;
      text-decoration: none;
      font-weight: 600;
      display: inline-block;
      padding-bottom: 2px;
    }
    a.link::after {
      content: "";
      position: absolute;
      left: 0; right: 0; bottom: 0;
      height: 2px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      border-radius: 999px;
      opacity: 0;              /* hidden by default */
      transform: translateY(0);
      transition: opacity .2s ease, transform .2s ease;
    }
    a.link:hover::after { opacity: 1; transform: translateY(-1px); }

    /* Headline gradient to match CTA */
    .glass-card h1 {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    /* Accessibility focus */
    .focus-ring:focus-visible {
      outline: 3px solid var(--outline);
      outline-offset: 2px;
      border-radius: 0.75rem;
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      .nebula, .btn-primary.pulse, .face-ring {
        animation: none !important;
      }
      #orbCanvas, #particles {
        display: none !important;
      }
    }

    /* Header actions area */
    .actions {
      position: fixed;
      z-index: 6;
      top: 1rem;
      right: 1rem;
      display: flex;
      gap: .5rem;
    }
    .toggle-theme {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(165,108,255,0.35);
      padding: .5rem .75rem;
      border-radius: 999px;
      box-shadow: var(--shadow-soft);
      cursor: pointer;
      user-select: none;
      color: var(--text);
      transition: background .2s ease, transform .2s ease, box-shadow .2s ease;
    }
    .toggle-theme:hover {
      transform: translateY(-2px);
      background: rgba(255,255,255,0.16);
      box-shadow: 0 10px 28px rgba(165,108,255,0.35);
    }

    /* Trust footer */
    .trust {
      display: flex;
      align-items: center;
      gap: .5rem;
      margin-top: .75rem;
      justify-content: center;
      color: var(--muted);
      font-size: .89rem;
      text-align: center;
    }

    /* Helper utilities when Tailwind isn't used for specific elements */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
  </style>
</head>
<body class="theme-dark">

  <!-- Subtle moving nebula background -->
  <div id="cf-login" class="sr-only" aria-hidden="true"></div>

  <style>
    @keyframes floaty { 0%{ transform: translateY(0) } 50%{ transform: translateY(-6px) } 100%{ transform: translateY(0) } }
    .floaty { animation: floaty 6s ease-in-out infinite; }
    .btn-social svg { display: inline-block; }
  </style>

  <!-- Particles canvas -->
  <canvas id="particles" aria-hidden="true"></canvas>

  <!-- Three.js Orb -->
  <canvas id="orbCanvas" aria-hidden="true"></canvas>

  <!-- Biometric ripple overlay -->
  <div class="ripple-overlay" id="rippleOverlay" aria-hidden="true"></div>

  <!-- Noise overlay -->
  <div class="noise-overlay" id="noiseOverlay" aria-hidden="true"></div>

  <!-- Left half-page logo panel -->
  <aside class="logo-panel" aria-hidden="true">
    <img src="./logo.png" alt="Salmar" />
  </aside>

  <!-- Main container -->
  <main class="container">
    <section class="glass-card" role="form" aria-labelledby="welcomeTitle" aria-describedby="welcomeDesc">
      <div class="inner">
        <!-- Center heading only (logo moved to top-left) -->

        <!-- Welcome messages -->
        <h1 id="welcomeTitle" class="text-center text-2xl sm:text-3xl font-extrabold tracking-tight mb-1">
          Welcome back, Explorer.
        </h1>
        <p id="welcomeDesc" class="text-center text-sm sm:text-base mb-5" style="color: var(--muted);">
          Step into the future with Salmar.
        </p>

        <!-- Login form -->
        <form id="loginForm" novalidate>
          <!-- Email -->
          <div class="field mb-3">
            <label for="email" class="block text-sm font-semibold mb-1" style="color: var(--muted);">Email or Username</label>
            <input id="email" name="email" type="text" required autocomplete="username" placeholder="you@galaxy.io"
              aria-describedby="emailHelp" aria-invalid="false" class="focus-ring" />
            <div aria-live="polite" id="emailHelp" class="mt-1 text-xs" style="color: var(--muted);"></div>
            <div class="spark-area" aria-hidden="true"></div>
          </div>

          <!-- Password -->
          <div class="field mb-4">
            <label for="password" class="block text-sm font-semibold mb-1" style="color: var(--muted);">Password</label>
            <input id="password" name="password" type="password" required autocomplete="current-password" placeholder="Enter your password"
              aria-describedby="passwordHelp" aria-invalid="false" class="focus-ring" />
            <button type="button" class="toggle-pass" id="togglePass" aria-label="Toggle password visibility">
              <svg id="eyeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 5c-5 0-9 5-9 7s4 7 9 7 9-5 9-7-4-7-9-7Z" stroke="currentColor" stroke-width="1.6" fill="none"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.6" fill="none"/>
              </svg>
            </button>
            <div aria-live="polite" id="passwordHelp" class="mt-1 text-xs" style="color: var(--muted);"></div>
            <div class="spark-area" aria-hidden="true"></div>
          </div>

          <!-- Actions row -->
          <div class="flex items-center justify-between mb-4">
            <div class="text-sm">
              <a href="forgot.html" class="link">Forgot password?</a>
            </div>
            <div class="text-sm">
              <span style="color: var(--muted);">New here? </span><a href="signup.html" class="link">Create Account</a>
            </div>
          </div>

          <!-- Primary login -->
          <button type="submit" id="loginBtn" class="btn-primary pulse focus-ring" aria-label="Log In to Salmar">
            Log In to Salmar
          </button>

          <!-- Biometrics -->
          <div class="biometric mt-4">
            <div class="text-sm font-semibold" style="color: var(--muted);">
              Log in with Biometrics
            </div>
            <div class="bio-actions">
              <!-- Fingerprint -->
              <button type="button" id="fingerBtn" class="bio-btn focus-ring" aria-label="Use fingerprint to login">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 2c-4.4 0-8 3.6-8 8 0 3.5 1.2 6.8 3.3 9.4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M12 6c-2.2 0-4 1.8-4 4 0 2.9.8 5.7 2.3 8.1" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M12 10c-.6 0-1 .4-1 1 0 2 .5 3.9 1.5 5.6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M17 10c0 3-.7 5.8-2 8.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M7 10c0 3 .7 5.8 2 8.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
              </button>

              <!-- Face ID -->
              <button type="button" id="faceBtn" class="bio-btn focus-ring" aria-label="Use Face ID to login">
                <div class="face-ring" aria-hidden="true"></div>
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <rect x="3" y="3" width="6" height="6" rx="2" stroke="currentColor" stroke-width="1.6"/>
                  <rect x="15" y="3" width="6" height="6" rx="2" stroke="currentColor" stroke-width="1.6"/>
                  <rect x="3" y="15" width="6" height="6" rx="2" stroke="currentColor" stroke-width="1.6"/>
                  <rect x="15" y="15" width="6" height="6" rx="2" stroke="currentColor" stroke-width="1.6"/>
                  <circle cx="9" cy="10" r="1" fill="currentColor"/>
                  <circle cx="15" cy="10" r="1" fill="currentColor"/>
                  <path d="M8 14c1.2 1 2.8 1 4 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
            <div id="bioMsg" class="text-xs text-center" style="color: var(--muted);">
              Biometric not available? Use password instead.
            </div>
          </div>

          <!-- Divider -->
          <div class="divider my-4 text-xs uppercase tracking-wider">
            or
          </div>

          <!-- Social login -->
          <div class="flex items-center justify-center gap-3 mb-1">
            <!-- Google -->
            <button type="button" id="googleBtn" class="btn-social focus-ring" aria-label="Continue with Google">
              <svg width="18" height="18" viewBox="0 0 48 48" aria-hidden="true">
                <path fill="#FFC107" d="M43.611 20.083h-1.611V20H24v8h11.303c-1.651 4.657-6.08 8-11.303 8-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.844 1.156 7.949 3.051l5.657-5.657C33.136 6.053 28.805 4 24 4 12.954 4 4 12.954 4 24s8.954 20 20 20 20-8.954 20-20c0-1.341-.138-2.651-.389-3.917z"/>
                <path fill="#FF3D00" d="M6.306 14.691l6.571 4.818C14.455 15.376 18.808 12 24 12c3.059 0 5.844 1.156 7.949 3.051l5.657-5.657C33.136 6.053 28.805 4 24 4 16.318 4 9.734 8.337 6.306 14.691z"/>
                <path fill="#4CAF50" d="M24 44c4.698 0 8.979-1.604 12.346-4.336l-5.694-4.828C28.612 36.803 26.405 37.6 24 37.6c-5.202 0-9.606-3.33-11.243-7.97l-6.541 5.03C9.579 40.053 16.247 44 24 44z"/>
                <path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-0.793 2.235-2.232 4.174-4.123 5.557L36.652 39.6C40.407 36.168 43 30.977 43 25c0-1.341-.138-2.651-.389-3.917z"/>
              </svg>
            </button>
            <!-- Discord -->
            <button type="button" id="discordBtn" class="btn-social focus-ring" aria-label="Continue with Discord">
              <svg width="20" height="20" viewBox="0 0 71 55" aria-hidden="true">
                <path fill="currentColor" d="M60.1 4.9A58.5 58.5 0 0046.9 1a41.1 41.1 0 00-2 4.2 56 56 0 00-17.8 0 41.2 41.2 0 00-2-4.2A58.8 58.8 0 0012 4.9C1.7 20.8-.9 36.3.3 51.7a58.9 58.9 0 0018.2 3.3c1.4-1.9 2.7-3.9 3.8-6a37.4 37.4 0 01-6-2.9c.5-.3 1-.6 1.5-.9a40.9 40.9 0 0015.3 3.8 40.9 40.9 0 0015.3-3.8l1.5.9a37.4 37.4 0 01-6 2.9 42.7 42.7 0 003.8 6 58.9 58.9 0 0018.2-3.3c1.4-17.1-2.3-32.7-12.9-46.8zM23.8 37.2c-3 0-5.5-2.8-5.5-6.2 0-3.5 2.4-6.2 5.5-6.2 3 0 5.5 2.8 5.5 6.2 0 3.5-2.4 6.2-5.5 6.2zm23.4 0c-3 0-5.5-2.8-5.5-6.2 0-3.5 2.4-6.2 5.5-6.2 3 0 5.5 2.8 5.5 6.2 0 3.5-2.4 6.2-5.5 6.2z"/>
              </svg>
            </button>
            <!-- GitHub -->
            <button type="button" id="githubBtn" class="btn-social focus-ring" aria-label="Continue with GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor" d="M12 2a10 10 0 00-3.162 19.492c.5.093.683-.217.683-.483l-.013-1.695c-2.777.603-3.362-1.188-3.362-1.188-.455-1.158-1.112-1.467-1.112-1.467-.91-.622.069-.609.069-.609 1.005.07 1.533 1.032 1.533 1.032.894 1.53 2.347 1.088 2.917.833.092-.663.35-1.088.636-1.338-2.22-.252-4.555-1.11-4.555-4.942 0-1.09.39-1.984 1.029-2.682-.103-.253-.446-1.268.098-2.643 0 0 .84-.269 2.75 1.025A9.56 9.56 0 0112 6.844c.85.004 1.707.115 2.507.337 1.91-1.294 2.75-1.025 2.75-1.025.545 1.375.202 2.39.1 2.643.64.698 1.028 1.592 1.028 2.682 0 3.842-2.338 4.687-4.565 4.935.36.31.682.921.682 1.856l-.013 2.753c0 .269.18.58.69.481A10 10 0 0012 2z"/>
              </svg>
            </button>
          </div>

          <!-- Trust footer -->
          <div class="trust">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 2l7 4v6c0 5-3.5 9.5-7 10-3.5-.5-7-5-7-10V6l7-4z" stroke="currentColor" stroke-width="1.6" fill="none"/>
              <path d="M8 12l2.5 2.5L16 9" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Your identity is safe. Biometrically encrypted by Salmar.</span>
          </div>
        </form>
      </div>
    </section>
  </main>

  

  <script>
    // Tailwind init (optional customizations if needed)
    // tailwind.config = { theme: { extend: { } } };

    // Utility: Random float
    const rand = (min, max) => Math.random() * (max - min) + min;

    // Theme toggle removed; dark theme enforced via body.theme-dark

    // Button hover light tracking
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.addEventListener('pointermove', (e) => {
      const rect = loginBtn.getBoundingClientRect();
      loginBtn.style.setProperty('--mx', (e.clientX - rect.left) + 'px');
      loginBtn.style.setProperty('--my', (e.clientY - rect.top) + 'px');
    });

    // Password visibility toggle
    const passInputUI = document.getElementById('password');
    const togglePass = document.getElementById('togglePass');
    const eyeIcon = document.getElementById('eyeIcon');
    togglePass.addEventListener('click', () => {
      const isPassword = passInputUI.getAttribute('type') === 'password';
      passInputUI.setAttribute('type', isPassword ? 'text' : 'password');
      // Toggle "eye" to "eye-off" by morphing paths simply by toggling a slash overlay
      eyeIcon.innerHTML = isPassword
        ? '<path d="M3 3l18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><path d="M12 5c-5 0-9 5-9 7s4 7 9 7 9-5 9-7-4-7-9-7Z" stroke="currentColor" stroke-width="1.6" fill="none"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.6" fill="none"/>'
        : '<path d="M12 5c-5 0-9 5-9 7s4 7 9 7 9-5 9-7-4-7-9-7Z" stroke="currentColor" stroke-width="1.6" fill="none"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.6" fill="none"/>';
      passInputUI.focus();
    });

    // Real-time form validation (accessible)
    const emailInputUI = document.getElementById('email');
    const emailHelpUI = document.getElementById('emailHelp');
    const passwordHelpUI = document.getElementById('passwordHelp');
    const loginFormUI = document.getElementById('loginForm');

    function validateEmail(value) {
      const hasAt = /@/.test(value);
      const userOrEmailOK = value.length >= 3 && (hasAt ? /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value) : true);
      return userOrEmailOK;
    }
    function validatePassword(value) {
      return value.length >= 6;
    }
    function setValidity(el, valid, messageEl, message) {
      el.setAttribute('aria-invalid', valid ? 'false' : 'true');
      messageEl.textContent = valid ? '' : message;
      messageEl.style.color = valid ? 'var(--muted)' : '#ff8296';
    }

    emailInputUI.addEventListener('input', () => {
      const v = emailInputUI.value.trim();
      setValidity(emailInputUI, validateEmail(v), emailHelpUI, 'Please enter a valid email or username (min 3 chars).');
      spawnSparks(emailInputUI.closest('.field'));
    });
    passInputUI.addEventListener('input', () => {
      const v = passInputUI.value;
      setValidity(passInputUI, validatePassword(v), passwordHelpUI, 'Password must be at least 6 characters.');
      spawnSparks(passInputUI.closest('.field'));
    });

    // simple UI validation remains; actual auth handled below in module script
    loginFormUI.addEventListener('submit', (e) => {
      e.preventDefault();
    });

    // Subtle sparks when typing
    function spawnSparks(fieldEl) {
      const area = fieldEl.querySelector('.spark-area');
      if (!area) return;
      for (let i = 0; i < 3; i++) {
        const s = document.createElement('span');
        s.className = 'spark';
        const rect = area.getBoundingClientRect();
        const x = rand(8, rect.width - 8);
        const y = rand(6, rect.height - 6);
        s.style.left = x + 'px';
        s.style.top = y + 'px';
        s.style.transform = 'translate(-50%, -50%) scale(0.6)';
        area.appendChild(s);
        gsap.to(s, {
          duration: rand(0.6, 1.1),
          x: rand(-8, 8),
          y: rand(-10, -18),
          opacity: 0,
          scale: rand(0.6, 1.1),
          ease: 'power2.out',
          onComplete: () => s.remove()
        });
      }
    }

    // Particles background (custom canvas)
    const pCanvas = document.getElementById('particles');
    const pCtx = pCanvas.getContext('2d', { alpha: true });
    const DPR = Math.min(window.devicePixelRatio || 1, 2);
    let particles = [];
    function resizeCanvas() {
      pCanvas.width = Math.floor(window.innerWidth * DPR);
      pCanvas.height = Math.floor(window.innerHeight * DPR);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function initParticles() {
      const count = Math.floor((window.innerWidth * window.innerHeight) / 22000);
      particles = Array.from({ length: count }, () => ({
        x: rand(0, pCanvas.width),
        y: rand(0, pCanvas.height),
        r: rand(0.6 * DPR, 1.8 * DPR),
        a: rand(0.15, 0.5),
        vx: rand(-0.05, 0.05) * DPR,
        vy: rand(-0.03, 0.03) * DPR,
        tw: rand(0.001, 0.004)
      }));
    }
    initParticles();
    window.addEventListener('resize', initParticles);

    function renderParticles(t) {
      pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
      for (const p of particles) {
        p.x += p.vx;
        p.y += p.vy + Math.sin(t * p.tw) * 0.05;
        if (p.x < 0) p.x = pCanvas.width; else if (p.x > pCanvas.width) p.x = 0;
        if (p.y < 0) p.y = pCanvas.height; else if (p.y > pCanvas.height) p.y = 0;

        const g = pCtx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 4);
        g.addColorStop(0, `rgba(200,160,255,${p.a})`);
        g.addColorStop(1, 'rgba(0,0,0,0)');
        pCtx.fillStyle = g;
        pCtx.beginPath();
        pCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        pCtx.fill();
      }
      requestAnimationFrame(renderParticles);
    }
    requestAnimationFrame(renderParticles);

    // Noise texture generation (tiny)
    (function makeNoise() {
      try {
        const c = document.createElement('canvas');
        const s = 140;
        c.width = s; c.height = s;
        const ctx = c.getContext('2d');
        const imgData = ctx.createImageData(s, s);
        for (let i = 0; i < imgData.data.length; i += 4) {
          const shade = Math.random() * 255;
          imgData.data[i] = shade;
          imgData.data[i+1] = shade;
          imgData.data[i+2] = shade;
          imgData.data[i+3] = Math.random() * 22; // low alpha
        }
        ctx.putImageData(imgData, 0, 0);
        const url = c.toDataURL('image/png');
        document.getElementById('noiseOverlay').style.backgroundImage = `url(${url})`;
      } catch (e) {
        // graceful no-noise
      }
    })();

    // Three.js 3D Orb
    const orbCanvas = document.getElementById('orbCanvas');
    let renderer, scene, camera, orb, light;
    function initOrb() {
      renderer = new THREE.WebGLRenderer({ canvas: orbCanvas, alpha: true, antialias: true });
      renderer.setPixelRatio(DPR);
      renderer.setSize(window.innerWidth, window.innerHeight);
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(32, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.set(0, 0, 12);

      const geo = new THREE.SphereGeometry(3.2, 64, 64);
      const mat = new THREE.MeshPhysicalMaterial({
        color: new THREE.Color(0x7b2dff),
        emissive: new THREE.Color(0x6b3dfc),
        emissiveIntensity: 0.35,
        metalness: 0.2,
        roughness: 0.15,
        clearcoat: 0.85,
        clearcoatRoughness: 0.15,
        sheen: 1,
        sheenColor: new THREE.Color(0xb58fff),
        transmission: 0.4,
        thickness: 0.8
      });
      orb = new THREE.Mesh(geo, mat);
      scene.add(orb);

      const hemi = new THREE.HemisphereLight(0x9a6eff, 0x220044, 0.6);
      scene.add(hemi);

      light = new THREE.PointLight(0x8a2cff, 2.2, 60, 2);
      light.position.set(4, 3, 8);
      scene.add(light);

      window.addEventListener('resize', onOrbResize);
      requestAnimationFrame(animateOrb);
    }
    function onOrbResize() {
      if (!renderer) return;
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    }
    function animateOrb(time) {
      if (orb) {
        const t = time * 0.0003;
        orb.rotation.y = t;
        orb.rotation.x = Math.sin(t * 0.9) * 0.2;
        light.position.x = Math.sin(t * 1.5) * 6;
        light.position.y = Math.cos(t * 1.2) * 4 + 3;
        light.position.z = Math.cos(t) * 6 + 6;
      }
      renderer.render(scene, camera);
      requestAnimationFrame(animateOrb);
    }
    try {
      initOrb();
    } catch (e) {
      // WebGL not available, silently fail
      orbCanvas.style.display = 'none';
    }

    // Biometric availability and WebAuthn
    const bioMsg = document.getElementById('bioMsg');
    const fingerBtn = document.getElementById('fingerBtn');
    const faceBtn = document.getElementById('faceBtn');
    const logoOrb = document.getElementById('logoOrb');
    const rippleOverlay = document.getElementById('rippleOverlay');

    async function checkBiometricSupport() {
      try {
        const webAuthnSupported = window.PublicKeyCredential && typeof PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable === 'function';
        if (!webAuthnSupported) {
          bioMsg.textContent = 'Biometric not available? Use password instead.';
          return false;
        }
        const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
        bioMsg.textContent = available ? 'Use Touch ID / Face ID / Windows Hello if your device supports it.' : 'Biometric not available? Use password instead.';
        return available;
      } catch (e) {
        bioMsg.textContent = 'Biometric not available? Use password instead.';
        return false;
      }
    }
    checkBiometricSupport();

    // Ripple background wave
    function waveBackground() {
      gsap.fromTo(rippleOverlay, { opacity: 0, backgroundSize: '0% 0%' }, {
        opacity: 0.7,
        backgroundSize: '600% 600%',
        duration: 0.7,
        ease: 'power2.out',
        onComplete: () => gsap.to(rippleOverlay, { opacity: 0, duration: 0.6, ease: 'power1.out' })
      });
    }

    // Orb unlock pulse
    function unlockOrb() {
      logoOrb.classList.add('unlocked');
      try {
        if (orb && orb.material) {
          gsap.to(orb.material, { emissiveIntensity: 0.95, duration: 0.8, yoyo: true, repeat: 1, ease: 'sine.inOut' });
          gsap.to(orb.scale, { x: 1.06, y: 1.06, z: 1.06, duration: 0.6, yoyo: true, repeat: 1, ease: 'sine.inOut' });
        }
      } catch {}

      setTimeout(() => logoOrb.classList.remove('unlocked'), 1200);
    }

    // WebAuthn trigger (safe demo)
    async function triggerWebAuthn({ userVerification = 'preferred' } = {}) {
      // In a real app, fetch "publicKey" options from your server.
      const fakeChallenge = new Uint8Array(32);
      crypto.getRandomValues(fakeChallenge);
      const opts = {
        publicKey: {
          challenge: fakeChallenge,
          timeout: 60000,
          userVerification
          // rpId and allowCredentials would be provided by the server; omitted for demo.
        },
        mediation: 'optional'
      };
      try {
        if (!window.PublicKeyCredential) throw new Error('WebAuthn not supported in this environment.');
        const cred = await navigator.credentials.get(opts);
        if (cred) {
          waveBackground();
          unlockOrb();
          return { ok: true, cred };
        } else {
          throw new Error('No credential returned.');
        }
      } catch (err) {
        // Expected to fail in many sandboxed/cross-origin contexts
        bioMsg.textContent = 'Biometric not available? Use password instead.';
        return { ok: false, error: err };
      }
    }

    fingerBtn.addEventListener('click', async () => {
      gsap.fromTo(fingerBtn, { scale: 1 }, { scale: 0.96, duration: 0.12, yoyo: true, repeat: 1 });
      waveBackground();
      try { await window.authenticateViaPasskey?.(); unlockOrb(); } catch {}
    });

    faceBtn.addEventListener('click', async () => {
      gsap.fromTo(faceBtn, { scale: 1 }, { scale: 0.96, duration: 0.12, yoyo: true, repeat: 1 });
      waveBackground();
      try { await window.authenticateViaPasskey?.(); unlockOrb(); } catch {}
    });

    // Accessibility: keyboard "Enter" on bio buttons triggers click
    [fingerBtn, faceBtn].forEach(btn => {
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });
    });

    // Reduce motion: stop heavy animations if user prefers
    const mediaReduce = window.matchMedia('(prefers-reduced-motion: reduce)');
    function applyReducedMotion(e) {
      const reduce = e.matches;
      if (reduce) {
        try {
          cancelAnimationFrame(renderParticles);
        } catch {}
      }
    }
    if (mediaReduce) applyReducedMotion(mediaReduce);
    mediaReduce.addEventListener?.('change', applyReducedMotion);
  </script>

  <script type="module">
    import { getSession, signInIdentifier, signInWithProvider, authenticatePasskey } from './auth.js';
    import { TURNSTILE_SITE_KEY } from './auth.config.js';

    const mLoginForm = document.getElementById('loginForm');
    const mEmailInput = document.getElementById('email');
    const mPassInput = document.getElementById('password');
    const mEmailHelp = document.getElementById('emailHelp');
    const mPasswordHelp = document.getElementById('passwordHelp');
    const mGoogleBtn = document.getElementById('googleBtn');
    const mGithubBtn = document.getElementById('githubBtn');
    const mDiscordBtn = document.getElementById('discordBtn');

    // Redirect if already authenticated
    (async () => {
      const session = await getSession();
      if (session) window.location.replace('AI.html');
    })();

    // Invisible Turnstile on login page
    let captchaToken = null;
    function renderCaptcha() {
      try {
        if (!TURNSTILE_SITE_KEY) return;
        const el = document.getElementById('cf-login');
        if (!el) return;
        window.turnstile?.render(el, {
          sitekey: TURNSTILE_SITE_KEY,
          callback: (token) => { captchaToken = token; },
          'error-callback': () => { captchaToken = null; },
          'expired-callback': () => { captchaToken = null; },
          size: 'invisible'
        });
      } catch {}
    }
    window.addEventListener('load', renderCaptcha);

    async function ensureCaptchaToken(maxMs = 2000) {
      if (!TURNSTILE_SITE_KEY) return null; // captcha disabled
      // trigger execution; token will be set in callback
      try { window.turnstile?.execute?.(); } catch {}
      const started = Date.now();
      while (!captchaToken && Date.now() - started < maxMs) {
        await new Promise(r => setTimeout(r, 50));
      }
      return captchaToken;
    }

    // Expose passkey auth
    window.authenticateViaPasskey = async () => {
      try {
        mPasswordHelp.textContent = '';
        const identifier = mEmailInput.value.trim();
        await authenticatePasskey(identifier);
        window.location.replace('AI.html');
      } catch (e) {
        const msg = e?.message === 'user_not_found' ? 'User not found for biometric login.' : (e?.message || 'Biometric login failed.');
        mPasswordHelp.textContent = msg;
        mPasswordHelp.style.color = '#ff8296';
      }
    };

    // Submit handler
    mLoginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      mEmailHelp.textContent = '';
      mPasswordHelp.textContent = '';
      const identifier = mEmailInput.value.trim();
      const password = mPassInput.value;
      if (!identifier || !password) return;

      await ensureCaptchaToken();
      const { data, error } = await signInIdentifier({ identifier, password, captchaToken });
      if (error) {
        const msg = error?.message || 'Invalid credentials. Please try again.';
        mPasswordHelp.textContent = msg;
        mPasswordHelp.style.color = '#ff8296';
        return;
      }
      window.location.replace('AI.html');
    });

    // Social providers (optional)
    const redirectTo = 'salmar://auth-callback';
    mGoogleBtn?.addEventListener('click', async () => { try { window.turnstile?.execute?.(); } catch {} await signInWithProvider('google', { redirectTo, captchaToken }); });
    mGithubBtn?.addEventListener('click', async () => { try { window.turnstile?.execute?.(); } catch {} await signInWithProvider('github', { redirectTo, captchaToken }); });
    mDiscordBtn?.addEventListener('click', async () => { try { window.turnstile?.execute?.(); } catch {} await signInWithProvider('discord', { redirectTo, captchaToken }); });
  </script>
</body>
</html>
